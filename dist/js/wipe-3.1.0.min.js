/*!message-Zsp 3.1.0 发布日期:2018-11-27*/
function Wipe(t){this.conID=t.id,this.color=t.color||"#666",this.radius=t.radius,this.coverType=t.coverType,this.backImgUrl=t.backImgUrl,this.width=t.width,this.height=t.height,this.cas=document.getElementById(this.conID),this.context=cas.getContext("2d"),this._w=this.width,this._h=this.height,this.raduis=this.radius,this.moveX=this.moveX,this.moveY=this.moveY,this.isMouseDown=!1,this.callback=t.callback,this.transpercent=t.transpercent,this.wipetext=t.wipetext,this.drawMask(),this.addEvent()}function getAllLeft(t){for(var e=0;t;)e+=t.offsetLeft,t=t.offsetParent;return e}function getAllTop(t){for(var e=0;t;)e+=t.offsetTop,t=t.offsetParent;return e}Wipe.prototype.drawMask=function(){if("color"===this.coverType)this.context.fillStyle=this.color,this.context.fillRect(0,0,this._w,this._h),this.context.globalCompositeOperation="destination-out";else if("images"===this.coverType){var t=new Image,e=this;t.src=e.backImgUrl,t.onload=function(){e.context.drawImage(t,0,0,t.width,t.height,0,0,e._w,e._h),e.context.globalCompositeOperation="destination-out",e.context.font='24px "微软雅黑"',e.context.fillText(e.wipetext,e._w/2-64,e._h/2+4)}}},Wipe.prototype.drawT=function(t,e,o,i){if(2===arguments.length)this.context.save(),this.context.beginPath(),this.context.arc(t,e,this.raduis,0,2*Math.PI),this.context.strokeStyle="red",this.context.fill(),this.context.restore();else{if(4!==arguments.length)return!1;this.context.save(),this.context.lineCap="round",this.context.lineWidth=2*this.raduis,this.context.beginPath(),this.context.moveTo(t,e),this.context.lineTo(o,i),this.context.stroke(),this.context.restore()}},Wipe.prototype.clearRect=function(){this.context.clearRect(0,0,this._w,this._h)},Wipe.prototype.getTransparencyPercent=function(){for(var t=0,e=this.context.getImageData(0,0,this._w,this._h),o=0;o<e.data.length;o+=4){0===e.data[o+3]&&t++}return this.percent=t/(this._w*this._h)*100,console.log("透明点的个数："+t),console.log("占总面积"+Math.round(this.percent)+"%"),Math.round(this.percent)},Wipe.prototype.addEvent=function(){this.device=/android|webos|iPhone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase());var t=this.device?"touchstart":"mousedown",e=this.device?"touchmove":"mousemove",o=this.device?"touchend":"mouseup",c=this;this.cas.addEventListener(t,function(t){var e=document.documentElement.scrollTop||document.body.scrollTop,o=document.documentElement.scrollLeft||document.body.scrollLeft;c.isMouseDown=!0;var i=t||window.event;c.moveX=c.device?i.touches[0].clientX-getAllLeft(this)+o:i.clientX-getAllLeft(this)+o,c.moveY=c.device?i.touches[0].clientY-getAllTop(this)+e:i.clientY-getAllTop(this)+e,c.drawT(c.moveX,c.moveY)},!1),this.cas.addEventListener(e,function(t){var e=document.documentElement.scrollTop||document.body.scrollTop,o=document.documentElement.scrollLeft||document.body.scrollLeft;if(!c.isMouseDown)return!1;var i=t||window.event;i.preventDefault();var n=c.device?i.touches[0].clientX-getAllLeft(this)+o:i.clientX-getAllLeft(this)+o,s=c.device?i.touches[0].clientY-getAllTop(this)+e:i.clientY-getAllTop(this)+e;c.drawT(c.moveX,c.moveY,n,s),c.moveX=n,c.moveY=s},!1),this.cas.addEventListener(o,function(t){c.isMouseDown=!1;var e=setTimeout(function(){c.getTransparencyPercent()},1e3);console.log(c.getTransparencyPercent()),c.callback.call(null,e),c.getTransparencyPercent()>c.transpercent&&(alert("超过了"+c.transpercent+"%的面积"),c.clearRect())},!1)};