/*!wipe-Zsp 3.0.0 发布日期:2018-11-19*/
function Wipe(t){this.conID=t.id,this.color=t.color||"#666",this.radius=t.radius,this.coverType=t.coverType,this.backImgUrl=t.backImgUrl,this.width=t.width,this.height=t.height,this.cas=document.getElementById(this.conID),this.context=cas.getContext("2d"),this._w=this.width,this._h=this.height,this.raduis=this.radius,this.moveX=this.moveX,this.moveY=this.moveY,this.isMouseDown=!1,this.callback=t.callback,this.transpercent=t.transpercent,this.drawMask(),this.addEvent()}Wipe.prototype.drawMask=function(){if("color"===this.coverType)this.context.fillStyle=this.color,this.context.fillRect(0,0,this._w,this._h),this.context.globalCompositeOperation="destination-out";else if("images"===this.coverType){var t=new Image,e=this;t.src=e.backImgUrl,t.onload=function(){e.context.drawImage(t,0,0,t.width,t.height,0,0,e._w,e._h),e.context.globalCompositeOperation="destination-out"}}},Wipe.prototype.drawT=function(t,e,i,o){if(console.log("传递的实参个数"+arguments.length),2===arguments.length)this.context.save(),this.context.beginPath(),this.context.arc(t,e,this.raduis,0,2*Math.PI),this.context.strokeStyle="red",this.context.fill(),this.context.restore();else{if(4!==arguments.length)return!1;this.context.save(),this.context.lineCap="round",this.context.lineWidth=2*this.raduis,this.context.beginPath(),this.context.moveTo(t,e),this.context.lineTo(i,o),this.context.stroke(),this.context.restore()}},Wipe.prototype.clearRect=function(){this.context.clearRect(0,0,this._w,this._h)},Wipe.prototype.getTransparencyPercent=function(){for(var t=0,e=this.context.getImageData(0,0,this._w,this._h),i=0;i<e.data.length;i+=4){0===e.data[i+3]&&t++}return this.percent=t/(this._w*this._h)*100,console.log("透明点的个数："+t),console.log("占总面积"+Math.round(this.percent)+"%"),Math.round(this.percent)},Wipe.prototype.addEvent=function(){this.device=/android|webos|iPhone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase());var t=this.device?"touchstart":"mousedown",e=this.device?"touchmove":"mousemove",i=this.device?"touchend":"mouseup",s=this;this.cas.addEventListener(t,function(t){console.log("ok"),s.isMouseDown=!0;var e=t||window.event;s.moveX=s.device?e.touches[0].clientX:e.clientX,s.moveY=s.device?e.touches[0].clientY:e.clientY,s.drawT(s.moveX,s.moveY)},!1),this.cas.addEventListener(e,function(t){if(!s.isMouseDown)return!1;var e=t||window.event;e.preventDefault();var i=s.device?e.touches[0].clientX:e.clientX,o=s.device?e.touches[0].clientY:e.clientY;s.drawT(s.moveX,s.moveY,i,o),s.moveX=i,s.moveY=o},!1),this.cas.addEventListener(i,function(t){s.isMouseDown=!1,console.log(s.transpercent);var e=s.getTransparencyPercent();s.callback.call(null,e),s.getTransparencyPercent()>s.transpercent&&(alert("超过了"+s.transpercent+"%的面积"),s.clearRect())},!1)};